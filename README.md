<!-- Use {Ctrl + Shift + V} for Preview Mode-->
dev in python 3.13.9

## list of contents
- [install requirements](#requirements)
- [Base_line table](#base_line-table)
- [change_log table](#change_log)
- [psets_models table](#psets_models)
- [flow get new change_log record](#flow_change_log)

## requirements
This command is used to **install** all required libraries from the requirements file:
```cmd
pip install -r requirements.txt
```
This command is used to **generate (or get)** the list of currently installed libraries and save them into a requirements file:
```
pip freeze >> requirements.txt
```

## Base_line table
### Command to create a device_pset_baseline table
```sql
CREATE TABLE reporting.device_pset_baseline (
    id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
    device varchar(255) NULL,
    pset varchar(20) NULL,
    time_last_change timestamptz NULL,
    created_at timestamptz NULL,
    update_at timestamptz NULL
);
```

## change_log
### Command to create a change_log table Create

```sql
CREATE SEQUENCE reporting.pset_change_log_id_seq
START WITH 1
INCREMENT BY 1;
```
```sql
CREATE TABLE reporting.pset_change_log (
    log_id int4 NOT NULL DEFAULT nextval('reporting.pset_change_log_id_seq'),
    controller_id varchar(50),
    device varchar(255),
    pset varchar(20),
    time_last_change timestamptz,
    rev varchar(20),
    rev_time timestamptz,
    "user" varchar(50),
    note varchar(255),
    createdat timestamptz,
    torque_min double precision,
    torque_target double precision,
    torque_max double precision,
    angle_min double precision,
    angle_target double precision,
    angle_max double precision,
    CONSTRAINT pset_change_log_pk PRIMARY KEY (log_id, rev)
);
```
```sql
ALTER SEQUENCE reporting.pset_change_log_id_seq
OWNED BY reporting.pset_change_log.log_id;
```
### Example of a command to insert data in to change_log

```sql
INSERT INTO reporting.pset_change_log (
    controller_id,
    device,
    pset,
    time_last_change,
    rev,
    createdat,
    torque_min,
    torque_target,
    torque_max,
    angle_min,
    angle_target,
    angle_max
)
VALUES (
    'Ctrl-001',
    'TR2-88',
    '1',
    '2025-04-07 13:11:20',
    '0',
    CURRENT_TIMESTAMP,
    0,
    1,
    2,
    3,
    4,
    5
);
```

## psets_models
### Command to create a change_log table Create

```sql
CREATE TABLE dbo.tool_psets_models (
    Id serial4 NOT NULL,
    Station varchar(255) NOT NULL,
    Tool varchar(255),
    PSET text,
    ModelOfVehicle varchar(50)
);
```

### Restore command 
This command uses psql to connect to a PostgreSQL server and restore backup file
```
psql -h localhost -p 5454 -U postgres -d portal -f _Order_EOR__202511130254.sql
```

### Option Descriptions

| Option | Description | Example |
|--------|-------------|---------|
| **-h** | Host of the PostgreSQL server | `-h localhost` |
| **-p** | Port where PostgreSQL is running | `-p 5454` |
| **-U** | Username used to connect | `-U postgres` |
| **-d** | Target database to restore into | `-d portal` |
| **-f** | SQL file to be executed (input file) | `-f _Order_EOR__202511130254.sql` |


### flow_change_log
This file is used in Kestra.It is used to fetch new data and compare it with existing data. If any changes are detected, the new data will be appended to the list of columns "JsonData"

```
PSET_change_log\Flow\import_new_data.yaml
```

## device_controller
### Command to create a device_controller table Create
```sql
CREATE TABLE reporting.device_controller (
    deviceId int4 NULL,
    deviceName varchar(255) NULL,
    toolSerialNumber varchar(100) NULL,
    controllerSerialNumber varchar(100) NULL
);
```